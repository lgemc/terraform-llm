{"instance_id": "terraform-aws-firehose-001", "problem_statement": "Create a Kinesis Firehose delivery stream with an extended S3 destination and dynamic partitioning enabled. The stream should include processing configuration with record deaggregation and metadata extraction processors. Create an IAM role for Firehose with an assume role policy for firehose.amazonaws.com and an S3 bucket as the destination.", "difficulty": "medium", "tags": ["kinesis", "firehose", "s3", "streaming", "aws"], "provider": "aws", "region": "us-east-1", "expected_resources": {"aws_kinesis_firehose_delivery_stream": 1, "aws_iam_role": 1, "aws_s3_bucket": 1}, "required_outputs": ["firehose_arn", "bucket_arn"], "validation_script": "dataset/kinesis_firehose_s3/validation.py", "gold_solution": {"main.tf": "data \"aws_iam_policy_document\" \"firehose_assume_role\" {\n  statement {\n    effect = \"Allow\"\n    principals {\n      type        = \"Service\"\n      identifiers = [\"firehose.amazonaws.com\"]\n    }\n    actions = [\"sts:AssumeRole\"]\n  }\n}\n\nresource \"aws_iam_role\" \"firehose_role\" {\n  name               = \"firehose_test_role\"\n  assume_role_policy = data.aws_iam_policy_document.firehose_assume_role.json\n}\n\nresource \"aws_s3_bucket\" \"destination\" {\n  bucket = \"firehose-destination-bucket\"\n}\n\nresource \"aws_kinesis_firehose_delivery_stream\" \"extended_s3_stream\" {\n  name        = \"terraform-kinesis-firehose-extended-s3-test-stream\"\n  destination = \"extended_s3\"\n\n  extended_s3_configuration {\n    role_arn       = aws_iam_role.firehose_role.arn\n    bucket_arn     = aws_s3_bucket.destination.arn\n    buffering_size = 64\n\n    dynamic_partitioning_configuration {\n      enabled = true\n    }\n\n    prefix              = \"data/customer_id=!{partitionKeyFromQuery:customer_id}/year=!{timestamp:yyyy}/month=!{timestamp:MM}/day=!{timestamp:dd}/hour=!{timestamp:HH}/\"\n    error_output_prefix = \"errors/year=!{timestamp:yyyy}/month=!{timestamp:MM}/day=!{timestamp:dd}/hour=!{timestamp:HH}/!{firehose:error-output-type}/\"\n\n    processing_configuration {\n      enabled = true\n\n      processors {\n        type = \"RecordDeAggregation\"\n        parameters {\n          parameter_name  = \"SubRecordType\"\n          parameter_value = \"JSON\"\n        }\n      }\n\n      processors {\n        type = \"AppendDelimiterToRecord\"\n      }\n\n      processors {\n        type = \"MetadataExtraction\"\n        parameters {\n          parameter_name  = \"JsonParsingEngine\"\n          parameter_value = \"JQ-1.6\"\n        }\n        parameters {\n          parameter_name  = \"MetadataExtractionQuery\"\n          parameter_value = \"{customer_id:.customer_id}\"\n        }\n      }\n    }\n  }\n}\n\noutput \"firehose_arn\" {\n  value = aws_kinesis_firehose_delivery_stream.extended_s3_stream.arn\n}\n\noutput \"bucket_arn\" {\n  value = aws_s3_bucket.destination.arn\n}\n"}, "hints": ["Use destination = 'extended_s3' for extended S3 configuration", "Dynamic partitioning is enabled in dynamic_partitioning_configuration block", "IAM role needs assume_role_policy for firehose.amazonaws.com", "Processing configuration includes RecordDeAggregation and MetadataExtraction processors", "Prefix uses !{partitionKeyFromQuery:...} syntax for dynamic partitions"], "metadata": {"estimated_cost": "$0.00", "deployment_time_seconds": 180, "cleanup_required": true, "created_at": "2025-02-25", "author": "iac-eval"}}
