{"instance_id": "terraform-aws-r53-weighted-001", "problem_statement": "Configure a weighted routing policy using Route 53 that splits traffic between three RDS read replicas of a main database. Provision the main db_instance 'primary' in us-west-1. Create three replicas: 'replica_us_east' in us-east-1, 'replica_eu_central' in eu-central-1, and 'replica_ap_southeast' in ap-southeast-1. Use provider aliases and weighted Route 53 records pointing to each replica's endpoint.", "difficulty": "hard", "tags": ["route53", "rds", "multi-region", "weighted-routing", "dns", "aws"], "provider": "aws", "region": "us-east-1", "expected_resources": {"aws_db_instance": 4, "aws_route53_zone": 1, "aws_route53_record": 3}, "required_outputs": ["zone_id", "primary_endpoint"], "validation_script": "dataset/route53_weighted_rds_replicas/validation.py", "gold_solution": {"main.tf": "provider \"aws\" {\n  alias  = \"main\"\n  region = \"us-west-1\"\n}\n\nprovider \"aws\" {\n  alias  = \"us_east\"\n  region = \"us-east-1\"\n}\n\nprovider \"aws\" {\n  alias  = \"eu_central\"\n  region = \"eu-central-1\"\n}\n\nprovider \"aws\" {\n  alias  = \"ap_southeast\"\n  region = \"ap-southeast-1\"\n}\n\nresource \"aws_db_instance\" \"primary\" {\n  provider                = aws.main\n  identifier              = \"master\"\n  allocated_storage       = 20\n  engine                  = \"postgres\"\n  instance_class          = \"db.t3.micro\"\n  username                = \"dbadmin\"\n  password                = \"your_password_here\"\n  skip_final_snapshot     = true\n  backup_retention_period = 7\n}\n\nresource \"aws_db_instance\" \"replica_us_east\" {\n  provider            = aws.us_east\n  replicate_source_db = aws_db_instance.primary.arn\n  instance_class      = \"db.t3.micro\"\n  identifier          = \"mydb-replica-us-east\"\n  skip_final_snapshot = true\n}\n\nresource \"aws_db_instance\" \"replica_eu_central\" {\n  provider            = aws.eu_central\n  replicate_source_db = aws_db_instance.primary.arn\n  instance_class      = \"db.t3.micro\"\n  identifier          = \"mydb-replica-eu-central\"\n  skip_final_snapshot = true\n}\n\nresource \"aws_db_instance\" \"replica_ap_southeast\" {\n  provider            = aws.ap_southeast\n  replicate_source_db = aws_db_instance.primary.arn\n  instance_class      = \"db.t3.micro\"\n  identifier          = \"mydb-replica-ap-southeast\"\n  skip_final_snapshot = true\n}\n\nresource \"aws_route53_zone\" \"main\" {\n  provider = aws.main\n  name     = \"example53.com\"\n}\n\nresource \"aws_route53_record\" \"replica_us_east_cname\" {\n  provider = aws.main\n  zone_id  = aws_route53_zone.main.zone_id\n  name     = \"db.example53.com\"\n  type     = \"CNAME\"\n  records  = [aws_db_instance.replica_us_east.endpoint]\n  ttl      = \"60\"\n  weighted_routing_policy {\n    weight = 30\n  }\n  set_identifier = \"replica-us-east\"\n}\n\nresource \"aws_route53_record\" \"replica_eu_central_cname\" {\n  provider = aws.main\n  zone_id  = aws_route53_zone.main.zone_id\n  name     = \"db.example53.com\"\n  type     = \"CNAME\"\n  records  = [aws_db_instance.replica_eu_central.endpoint]\n  ttl      = \"60\"\n  weighted_routing_policy {\n    weight = 30\n  }\n  set_identifier = \"replica-eu-central\"\n}\n\nresource \"aws_route53_record\" \"replica_ap_southeast_cname\" {\n  provider = aws.main\n  zone_id  = aws_route53_zone.main.zone_id\n  name     = \"db.example53.com\"\n  type     = \"CNAME\"\n  records  = [aws_db_instance.replica_ap_southeast.endpoint]\n  ttl      = \"60\"\n  weighted_routing_policy {\n    weight = 30\n  }\n  set_identifier = \"replica-ap-southeast\"\n}\n\noutput \"zone_id\" {\n  value = aws_route53_zone.main.zone_id\n}\n\noutput \"primary_endpoint\" {\n  value = aws_db_instance.primary.endpoint\n}\n"}, "hints": ["Use provider aliases for each region", "The primary DB needs backup_retention_period > 0 for replicas", "Replicas use replicate_source_db referencing the primary ARN", "Route 53 records need weighted_routing_policy and set_identifier", "All records share the same name but different set_identifiers"], "metadata": {"estimated_cost": "$0.20 (multi-region RDS)", "deployment_time_seconds": 600, "cleanup_required": true, "created_at": "2025-02-25", "author": "iac-eval"}}
