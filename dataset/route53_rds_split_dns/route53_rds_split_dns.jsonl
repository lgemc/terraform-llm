{"instance_id": "terraform-aws-r53-rds-001", "problem_statement": "Configure Route 53 to return different database endpoints to internal versus external users. Internal users are routed to an internal RDS instance, while external users are routed to a publicly accessible one. Create a VPC with two subnets and a DB subnet group. Name the zones 'private' and 'public', the databases 'internal' and 'public', and the subnet group 'main'.", "difficulty": "hard", "tags": ["route53", "rds", "vpc", "dns", "split-horizon", "aws"], "provider": "aws", "region": "us-east-1", "expected_resources": {"aws_vpc": 1, "aws_subnet": 2, "aws_db_subnet_group": 1, "aws_db_instance": 2, "aws_route53_zone": 2, "aws_route53_record": 2}, "required_outputs": ["public_zone_id", "private_zone_id", "public_db_endpoint", "internal_db_endpoint"], "validation_script": "dataset/route53_rds_split_dns/validation.py", "gold_solution": {"main.tf": "resource \"aws_vpc\" \"main\" {\n  cidr_block = \"10.0.0.0/24\"\n}\n\nresource \"aws_subnet\" \"maina\" {\n  vpc_id            = aws_vpc.main.id\n  cidr_block        = \"10.0.0.0/25\"\n  availability_zone = \"us-east-1a\"\n}\n\nresource \"aws_subnet\" \"mainb\" {\n  vpc_id            = aws_vpc.main.id\n  cidr_block        = \"10.0.0.128/25\"\n  availability_zone = \"us-east-1b\"\n}\n\nresource \"aws_db_subnet_group\" \"main\" {\n  name       = \"mydb-subnet-group\"\n  subnet_ids = [aws_subnet.maina.id, aws_subnet.mainb.id]\n}\n\nresource \"aws_db_instance\" \"internal\" {\n  allocated_storage    = 20\n  engine               = \"mysql\"\n  instance_class       = \"db.t3.micro\"\n  identifier           = \"internal\"\n  username             = \"user\"\n  password             = \"password\"\n  db_subnet_group_name = aws_db_subnet_group.main.name\n  skip_final_snapshot  = true\n}\n\nresource \"aws_db_instance\" \"public\" {\n  publicly_accessible = true\n  allocated_storage   = 20\n  engine              = \"mysql\"\n  instance_class      = \"db.t3.micro\"\n  identifier          = \"public\"\n  username            = \"user\"\n  password            = \"password\"\n  skip_final_snapshot = true\n}\n\nresource \"aws_route53_zone\" \"public\" {\n  name = \"example53.com\"\n}\n\nresource \"aws_route53_zone\" \"private\" {\n  name = \"example53.com\"\n  vpc {\n    vpc_id = aws_vpc.main.id\n  }\n}\n\nresource \"aws_route53_record\" \"public_db\" {\n  zone_id = aws_route53_zone.public.zone_id\n  name    = \"db.example53.com\"\n  type    = \"CNAME\"\n  ttl     = \"300\"\n  records = [aws_db_instance.public.address]\n}\n\nresource \"aws_route53_record\" \"internal_db\" {\n  zone_id = aws_route53_zone.private.zone_id\n  name    = \"db.example53.com\"\n  type    = \"CNAME\"\n  ttl     = \"300\"\n  records = [aws_db_instance.internal.address]\n}\n\noutput \"public_zone_id\" {\n  value = aws_route53_zone.public.zone_id\n}\n\noutput \"private_zone_id\" {\n  value = aws_route53_zone.private.zone_id\n}\n\noutput \"public_db_endpoint\" {\n  value = aws_db_instance.public.address\n}\n\noutput \"internal_db_endpoint\" {\n  value = aws_db_instance.internal.address\n}\n"}, "hints": ["Create a public and private Route 53 zone with the same domain name", "The private zone needs a vpc block with vpc_id", "Create two RDS instances: one internal with db_subnet_group_name, one public with publicly_accessible", "Route 53 records should be CNAME type pointing to db instance addresses", "You need a VPC, two subnets in different AZs, and a DB subnet group"], "metadata": {"estimated_cost": "$0.10 (RDS instances)", "deployment_time_seconds": 300, "cleanup_required": true, "created_at": "2025-02-25", "author": "iac-eval"}}
